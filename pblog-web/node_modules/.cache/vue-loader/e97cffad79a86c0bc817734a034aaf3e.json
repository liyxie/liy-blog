{"remainingRequest":"E:\\MyWenJian\\Blogs\\rulin-blog\\pblog-web\\node_modules\\.store\\vue-loader@15.11.1\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\MyWenJian\\Blogs\\rulin-blog\\pblog-web\\src\\components\\Comment.vue?vue&type=style&index=0&id=133ed8df&scoped=true&lang=css","dependencies":[{"path":"E:\\MyWenJian\\Blogs\\rulin-blog\\pblog-web\\src\\components\\Comment.vue","mtime":1721286706039},{"path":"E:\\MyWenJian\\Blogs\\rulin-blog\\pblog-web\\node_modules\\.store\\css-loader@3.6.0\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\MyWenJian\\Blogs\\rulin-blog\\pblog-web\\node_modules\\.store\\vue-loader@15.11.1\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\MyWenJian\\Blogs\\rulin-blog\\pblog-web\\node_modules\\.store\\postcss-loader@3.0.0\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\MyWenJian\\Blogs\\rulin-blog\\pblog-web\\node_modules\\.store\\cache-loader@4.1.0\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\MyWenJian\\Blogs\\rulin-blog\\pblog-web\\node_modules\\.store\\vue-loader@15.11.1\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpwIHsNCiAgbWFyZ2luLWJvdHRvbTogMS4yNXJlbSAhaW1wb3J0YW50Ow0KfQ0KLmJsb2dnZXItdGFnIHsNCiAgYmFja2dyb3VuZDogI2ZmYTUxZTsNCiAgZm9udC1zaXplOiAxMnB4Ow0KICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogIGJvcmRlci1yYWRpdXM6IDJweDsNCiAgY29sb3I6ICNmZmY7DQogIHBhZGRpbmc6IDAgNXB4Ow0KICBtYXJnaW4tbGVmdDogNnB4Ow0KfQ0KLmNvbW1lbnQtdGl0bGUgew0KICBkaXNwbGF5OiBmbGV4Ow0KICBhbGlnbi1pdGVtczogY2VudGVyOw0KICBmb250LXNpemU6IDEuMjVyZW07DQogIGZvbnQtd2VpZ2h0OiBib2xkOw0KICBsaW5lLWhlaWdodDogNDBweDsNCiAgbWFyZ2luLWJvdHRvbTogMTBweDsNCn0NCi5jb21tZW50LXRpdGxlIGkgew0KICBmb250LXNpemU6IDEuNXJlbTsNCiAgbWFyZ2luLXJpZ2h0OiA1cHg7DQp9DQouY29tbWVudC1pbnB1dC13cmFwcGVyIHsNCiAgYm9yZGVyOiAxcHggc29saWQgIzkwOTM5OTUwOw0KICBib3JkZXItcmFkaXVzOiA0cHg7DQogIHBhZGRpbmc6IDEwcHg7DQogIG1hcmdpbjogMCAwIDEwcHg7DQp9DQouY291bnQgew0KICBwYWRkaW5nOiA1cHg7DQogIGxpbmUtaGVpZ2h0OiAxLjc1Ow0KICBmb250LXNpemU6IDEuMjVyZW07DQogIGZvbnQtd2VpZ2h0OiBib2xkOw0KfQ0KLmNvbW1lbnQtbWV0YSB7DQogIG1hcmdpbi1sZWZ0OiAwLjhyZW07DQogIHdpZHRoOiAxMDAlOw0KICBib3JkZXItYm90dG9tOiAxcHggZGFzaGVkICNmNWY1ZjU7DQp9DQoucmVwbHktbWV0YSB7DQogIG1hcmdpbi1sZWZ0OiAwLjhyZW07DQogIHdpZHRoOiAxMDAlOw0KfQ0KLmNvbW1lbnQtdXNlciB7DQogIGZvbnQtc2l6ZTogMTRweDsNCiAgbGluZS1oZWlnaHQ6IDEuNzU7DQp9DQouY29tbWVudC11c2VyIGEgew0KICBjb2xvcjogIzFhYmM5YyAhaW1wb3J0YW50Ow0KICBmb250LXdlaWdodDogNTAwOw0KICB0cmFuc2l0aW9uOiAwLjNzIGFsbDsNCn0NCi5jb21tZW50LW5pY2tuYW1lIHsNCiAgdGV4dC1kZWNvcmF0aW9uOiBub25lOw0KICBjb2xvcjogIzFhYmM5YyAhaW1wb3J0YW50Ow0KICBmb250LXdlaWdodDogNTAwOw0KfQ0KLmNvbW1lbnQtaW5mbyB7DQogIGxpbmUtaGVpZ2h0OiAxLjc1Ow0KICBmb250LXNpemU6IDAuNzVyZW07DQogIGNvbG9yOiAjYjNiM2IzOw0KfQ0KLnJlcGx5LWJ0biB7DQogIGN1cnNvcjogcG9pbnRlcjsNCiAgZmxvYXQ6IHJpZ2h0Ow0KICBjb2xvcjogI2VmMmYxMTsNCn0NCi5jb21tZW50LWNvbnRlbnQgew0KICBmb250LXNpemU6IDAuODc1cmVtOw0KICBsaW5lLWhlaWdodDogMS43NTsNCiAgcGFkZGluZy10b3A6IDAuNjI1cmVtOw0KfQ0KLmNvbW1lbnQtYXZhdGFyIHsNCiAgdHJhbnNpdGlvbjogYWxsIDAuNXM7DQp9DQouY29tbWVudC1hdmF0YXI6aG92ZXIgew0KICB0cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOw0KfQ0KLmxpa2Ugew0KICBjdXJzb3I6IHBvaW50ZXI7DQogIGZvbnQtc2l6ZTogMC44NzVyZW07DQp9DQoubGlrZTpob3ZlciB7DQogIGNvbG9yOiAjZWI1MDU1Ow0KfQ0KLmxpa2UtYWN0aXZlIHsNCiAgY3Vyc29yOiBwb2ludGVyOw0KICBmb250LXNpemU6IDAuODc1cmVtOw0KICBjb2xvcjogI2ViNTA1NTsNCn0NCi5sb2FkLXdyYXBwZXIgew0KICBtYXJnaW4tdG9wOiAxMHB4Ow0KICBkaXNwbGF5OiBmbGV4Ow0KICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCn0NCi5sb2FkLXdyYXBwZXIgYnV0dG9uIHsNCiAgYmFja2dyb3VuZC1jb2xvcjogIzQ5YjFmNTsNCiAgY29sb3I6ICNmZmY7DQp9DQo="},{"version":3,"sources":["Comment.vue"],"names":[],"mappings":";AAiWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Comment.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"comment-title\"><i class=\"iconfont iconpinglunzu\" />评论</div>\r\n    <!-- 评论框 -->\r\n    <div class=\"comment-input-wrapper\">\r\n      <div style=\"display:flex\">\r\n        <v-avatar size=\"40\">\r\n          <img\r\n            v-if=\"this.$store.state.avatar\"\r\n            :src=\"this.$store.state.avatar\"\r\n          />\r\n          <img\r\n            v-else\r\n            :src=\"this.$store.state.blogInfo.webSite.touristAvatar\"\r\n          />\r\n        </v-avatar>\r\n        <div style=\"width:100%\" class=\"ml-3\">\r\n          <div class=\"comment-input\">\r\n            <textarea\r\n              class=\"comment-textarea\"\r\n              v-model=\"commentContent\"\r\n              placeholder=\"留下点什么吧...\"\r\n              auto-grow\r\n              dense\r\n            />\r\n          </div>\r\n          <!-- 操作按钮 -->\r\n          <div class=\"emoji-container\">\r\n            <span\r\n              :class=\"chooseEmoji ? 'emoji-btn-active' : 'emoji-btn'\"\r\n              @click=\"chooseEmoji = !chooseEmoji\"\r\n            >\r\n              <i class=\"iconfont iconbiaoqing\" />\r\n            </span>\r\n            <button\r\n              @click=\"insertComment\"\r\n              class=\"upload-btn v-comment-btn\"\r\n              style=\"margin-left:auto\"\r\n            >\r\n              提交\r\n            </button>\r\n          </div>\r\n          <!-- 表情框 -->\r\n          <emoji @addEmoji=\"addEmoji\" :chooseEmoji=\"chooseEmoji\" />\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!-- 评论详情 -->\r\n    <div v-if=\"count > 0 && reFresh\">\r\n      <!-- 评论数量 -->\r\n      <div class=\"count\">{{ count }} 评论</div>\r\n      <!-- 评论列表 -->\r\n      <div\r\n        style=\"display:flex\"\r\n        class=\"pt-5\"\r\n        v-for=\"(item, index) of commentList\"\r\n        :key=\"item.id\"\r\n      >\r\n        <!-- 头像 -->\r\n        <v-avatar size=\"40\" class=\"comment-avatar\">\r\n          <img :src=\"item.avatar\" />\r\n        </v-avatar>\r\n        <div class=\"comment-meta\">\r\n          <!-- 用户名 -->\r\n          <div class=\"comment-user\">\r\n            <span v-if=\"!item.webSite\">{{ item.nickname }}</span>\r\n            <a v-else :href=\"item.webSite\" target=\"_blank\">\r\n              {{ item.nickname }}\r\n            </a>\r\n            <span class=\"blogger-tag\" v-if=\"item.userId == 1\">博主</span>\r\n          </div>\r\n          <!-- 信息 -->\r\n          <div class=\"comment-info\">\r\n            <!-- 楼层 -->\r\n            <span style=\"margin-right:10px\">{{ count - index }}楼</span>\r\n            <!-- 发表时间 -->\r\n            <span style=\"margin-right:10px\">{{ item.createTime | date }}</span>\r\n            <!-- 点赞 -->\r\n<!--            <span\r\n              :class=\"isLike(item.id) + ' iconfont icondianzan'\"\r\n              @click=\"like(item)\"\r\n            />-->\r\n            <span v-show=\"item.likeCount > 0\"> {{ item.likeCount }}</span>\r\n            <!-- 回复 -->\r\n            <span class=\"reply-btn\" @click=\"replyComment(index, item)\">\r\n              回复\r\n            </span>\r\n          </div>\r\n          <!-- 评论内容 -->\r\n          <p v-html=\"item.commentContent\" class=\"comment-content\"></p>\r\n          <!-- 回复人 -->\r\n          <div\r\n            style=\"display:flex\"\r\n            v-for=\"reply of item.replyDTOList\"\r\n            :key=\"reply.id\"\r\n          >\r\n            <!-- 头像 -->\r\n            <v-avatar size=\"36\" class=\"comment-avatar\">\r\n              <img :src=\"reply.avatar\" />\r\n            </v-avatar>\r\n            <div class=\"reply-meta\">\r\n              <!-- 用户名 -->\r\n              <div class=\"comment-user\">\r\n                <span v-if=\"!reply.webSite\">{{ reply.nickname }}</span>\r\n                <a v-else :href=\"reply.webSite\" target=\"_blank\">\r\n                  {{ reply.nickname }}\r\n                </a>\r\n                <span class=\"blogger-tag\" v-if=\"reply.userId === 1\">博主</span>\r\n              </div>\r\n              <!-- 信息 -->\r\n              <div class=\"comment-info\">\r\n\r\n                <!-- 发表时间 -->\r\n                <span style=\"margin-right:10px\">\r\n                  {{ reply.createTime | date }}\r\n                </span>\r\n                <!-- 点赞 -->\r\n<!--                <span\r\n                  :class=\"isLike(reply.id) + ' iconfont icondianzan'\"\r\n                  @click=\"like(reply)\"\r\n                />-->\r\n                <span v-show=\"reply.likeCount > 0\"> {{ reply.likeCount }}</span>\r\n                <!-- 回复 -->\r\n                <span class=\"reply-btn\" @click=\"replyComment(index, reply)\">\r\n                  回复\r\n                </span>\r\n              </div>\r\n              <!-- 回复内容 -->\r\n              <p class=\"comment-content\">\r\n                <!-- 回复用户名 -->\r\n                <template v-if=\"reply.replyUserId !== item.userId\">\r\n                  <span v-if=\"!reply.replyWebSite\" class=\"comment-nickname ml-1\">\r\n                    @{{ reply.replyNickname }}\r\n                  </span>\r\n                  <a\r\n                    v-else\r\n                    :href=\"reply.replyWebSite\"\r\n                    target=\"_blank\"\r\n                    class=\"comment-nickname ml-1\"\r\n                  >\r\n                    @{{ reply.replyNickname }}\r\n                  </a>\r\n                </template>\r\n                <span v-html=\"reply.content\" />\r\n              </p>\r\n            </div>\r\n          </div>\r\n          <!-- 回复数量 -->\r\n          <div\r\n            class=\"mb-3\"\r\n            style=\"font-size:0.75rem;color:#6d757a\"\r\n            v-show=\"item.replyCount > 3\"\r\n            ref=\"check\"\r\n          >\r\n            共\r\n            <b>{{ item.replyCount }}</b>\r\n            条回复，\r\n            <span\r\n              style=\"color:#00a1d6;cursor:pointer\"\r\n              @click=\"checkReplies(index, item)\"\r\n            >\r\n              点击查看\r\n            </span>\r\n          </div>\r\n          <!-- 回复分页 -->\r\n          <div\r\n            class=\"mb-3\"\r\n            style=\"font-size:0.75rem;color:#222;display:none\"\r\n            ref=\"paging\"\r\n          >\r\n            <span style=\"padding-right:10px\">\r\n              共{{ Math.ceil(item.replyCount / 5) }}页\r\n            </span>\r\n            <paging\r\n              ref=\"page\"\r\n              :totalPage=\"Math.ceil(item.replyCount / 5)\"\r\n              :index=\"index\"\r\n              :commentId=\"item.id\"\r\n              @changeReplyCurrent=\"changeReplyCurrent\"\r\n            />\r\n          </div>\r\n          <!-- 回复框 -->\r\n          <Reply ref=\"reply\" @reloadReply=\"reloadReply\" />\r\n        </div>\r\n      </div>\r\n      <!-- 加载按钮 -->\r\n      <div class=\"load-wrapper\">\r\n        <v-btn outlined v-if=\"count > commentList.length\" @click=\"listComments\">\r\n          加载更多...\r\n        </v-btn>\r\n      </div>\r\n    </div>\r\n    <!-- 没有评论提示 -->\r\n    <div v-else style=\"padding:1.25rem;text-align:center\">\r\n      来发评论吧~\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Reply from \"./Reply\";\r\nimport Paging from \"./Paging\";\r\nimport Emoji from \"./Emoji\";\r\nimport EmojiList from \"../assets/js/emoji\";\r\nimport {addComment,fetchComments,repliesByComId} from '../api'\r\nexport default {\r\n  components: {\r\n    Reply,\r\n    Emoji,\r\n    Paging\r\n  },\r\n  props: {\r\n    commentList: {\r\n      type: Array\r\n    },\r\n    count: {\r\n      type: Number\r\n    }\r\n  },\r\n  data: function() {\r\n    return {\r\n      reFresh: true,\r\n      img: process.env.VUE_APP_IMG_API,\r\n      commentContent: \"\",\r\n      chooseEmoji: false,\r\n      current: 1\r\n    };\r\n  },\r\n  methods: {\r\n    replyComment(index, item) {\r\n      this.$refs.reply.forEach(item => {\r\n        item.$el.style.display = \"none\";\r\n      });\r\n      //传值给回复框\r\n      this.$refs.reply[index].commentContent = \"\";\r\n      this.$refs.reply[index].nickname = item.nickname;\r\n      this.$refs.reply[index].replyUserId = item.userId;\r\n      this.$refs.reply[index].parentId = this.commentList[index].id;\r\n      this.$refs.reply[index].chooseEmoji = false;\r\n      this.$refs.reply[index].index = index;\r\n      this.$refs.reply[index].$el.style.display = \"block\";\r\n    },\r\n    addEmoji(key) {\r\n      this.commentContent += key;\r\n    },\r\n    checkReplies(index, item) {\r\n      repliesByComId( {commentId:item.id, pageNo: 1, pageSize: 5 }).then(res => {\r\n          this.$refs.check[index].style.display = \"none\";\r\n          item.replyDTOList = res.data;\r\n          //超过1页才显示分页\r\n          if (Math.ceil(item.replyCount / 5) > 1) {\r\n            this.$refs.paging[index].style.display = \"flex\";\r\n          }\r\n        });\r\n    },\r\n    changeReplyCurrent(current, index, commentId) {\r\n      //查看下一页回复\r\n      repliesByComId( {commentId:commentId, pageNo: current, pageSize: 5 }).then(res => {\r\n          this.commentList[index].replyDTOList = res.data;\r\n        });\r\n    },\r\n    listComments() {\r\n      //查看下一页评论\r\n      this.current++;\r\n      const path = this.$route.path;\r\n      const arr = path.split(\"/\");\r\n      fetchComments( { pageNo: this.current,pageSize:10, articleId: arr[2] }).then(res => {\r\n        res.data.commentDTOList.forEach(item =>{\r\n          this.commentList.push(item);\r\n        })\r\n      });\r\n    },\r\n    insertComment() {\r\n      //判断登录\r\n      let userId = this.$store.state.userId;\r\n      if (!userId) {\r\n        this.$store.state.loginFlag = true;\r\n        return false;\r\n      }\r\n      //判空\r\n      if (this.commentContent.trim() === \"\") {\r\n        this.$toast({ type: \"error\", message: \"评论不能为空\" });\r\n        return false;\r\n      }\r\n      //解析表情\r\n      var reg = /\\[.+?\\]/g;\r\n      this.commentContent = this.commentContent.replace(reg, function(str) {\r\n        return (\r\n          \"<img src= '\" +\r\n          EmojiList[str] +\r\n          \"' width='22'height='20' style='padding: 0 1px'/>\"\r\n        );\r\n      });\r\n      //发送请求\r\n      const path = this.$route.path;\r\n      const arr = path.split(\"/\");\r\n      var comment = {\r\n        articleId: arr[2],\r\n        commentContent: this.commentContent\r\n      };\r\n      this.commentContent = \"\";\r\n      addComment(comment).then(res => {\r\n          //查询最新评论\r\n          this.$emit(\"reloadComment\");\r\n          this.$toast({ type: \"success\", message: \"评论成功\" });\r\n         /* const isReview = this.$store.state.blogInfo.websiteConfig\r\n            .isCommentReview;\r\n          if (isReview) {\r\n            this.$toast({ type: \"warnning\", message: \"评论成功，正在审核中\" });\r\n          } else {\r\n            this.$toast({ type: \"success\", message: \"评论成功\" });\r\n          }*/\r\n      }).catch(err =>{\r\n        console.error(err)\r\n      });\r\n    },\r\n    reloadReply(index) {\r\n      repliesByComId( {\r\n            commentId:this.commentList[index].id,\r\n            pageSize:5,\r\n            pageNo: this.$refs.page[index].current\r\n          }).then(res => {\r\n          this.commentList[index].replyCount++;\r\n          //回复大于5条展示分页\r\n          if (this.commentList[index].replyCount > 5) {\r\n            this.$refs.paging[index].style.display = \"flex\";\r\n          }\r\n          this.$refs.check[index].style.display = \"none\";\r\n          this.$refs.reply[index].$el.style.display = \"none\";\r\n          this.commentList[index].replyDTOList = res.data;\r\n        });\r\n    }\r\n  },\r\n /* computed: {\r\n    isLike() {\r\n      return function(commentId) {\r\n        var commentLikeSet = this.$store.state.commentLikeSet;\r\n        return commentLikeSet.indexOf(commentId) != -1 ? \"like-active\" : \"like\";\r\n      };\r\n    }\r\n  },*/\r\n  watch: {\r\n    commentList() {\r\n      this.reFresh = false;\r\n      this.$nextTick(() => {\r\n        this.reFresh = true;\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\np {\r\n  margin-bottom: 1.25rem !important;\r\n}\r\n.blogger-tag {\r\n  background: #ffa51e;\r\n  font-size: 12px;\r\n  display: inline-block;\r\n  border-radius: 2px;\r\n  color: #fff;\r\n  padding: 0 5px;\r\n  margin-left: 6px;\r\n}\r\n.comment-title {\r\n  display: flex;\r\n  align-items: center;\r\n  font-size: 1.25rem;\r\n  font-weight: bold;\r\n  line-height: 40px;\r\n  margin-bottom: 10px;\r\n}\r\n.comment-title i {\r\n  font-size: 1.5rem;\r\n  margin-right: 5px;\r\n}\r\n.comment-input-wrapper {\r\n  border: 1px solid #90939950;\r\n  border-radius: 4px;\r\n  padding: 10px;\r\n  margin: 0 0 10px;\r\n}\r\n.count {\r\n  padding: 5px;\r\n  line-height: 1.75;\r\n  font-size: 1.25rem;\r\n  font-weight: bold;\r\n}\r\n.comment-meta {\r\n  margin-left: 0.8rem;\r\n  width: 100%;\r\n  border-bottom: 1px dashed #f5f5f5;\r\n}\r\n.reply-meta {\r\n  margin-left: 0.8rem;\r\n  width: 100%;\r\n}\r\n.comment-user {\r\n  font-size: 14px;\r\n  line-height: 1.75;\r\n}\r\n.comment-user a {\r\n  color: #1abc9c !important;\r\n  font-weight: 500;\r\n  transition: 0.3s all;\r\n}\r\n.comment-nickname {\r\n  text-decoration: none;\r\n  color: #1abc9c !important;\r\n  font-weight: 500;\r\n}\r\n.comment-info {\r\n  line-height: 1.75;\r\n  font-size: 0.75rem;\r\n  color: #b3b3b3;\r\n}\r\n.reply-btn {\r\n  cursor: pointer;\r\n  float: right;\r\n  color: #ef2f11;\r\n}\r\n.comment-content {\r\n  font-size: 0.875rem;\r\n  line-height: 1.75;\r\n  padding-top: 0.625rem;\r\n}\r\n.comment-avatar {\r\n  transition: all 0.5s;\r\n}\r\n.comment-avatar:hover {\r\n  transform: rotate(360deg);\r\n}\r\n.like {\r\n  cursor: pointer;\r\n  font-size: 0.875rem;\r\n}\r\n.like:hover {\r\n  color: #eb5055;\r\n}\r\n.like-active {\r\n  cursor: pointer;\r\n  font-size: 0.875rem;\r\n  color: #eb5055;\r\n}\r\n.load-wrapper {\r\n  margin-top: 10px;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n.load-wrapper button {\r\n  background-color: #49b1f5;\r\n  color: #fff;\r\n}\r\n</style>\r\n"]}]}